{% extends "layout.html" %}

{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<h2>Nota {{ num }}</h2>
<h3>{{ nombre }}</h3>

<div class="row">
    <div class="col-md-4">
        <h4>Redactores:</h4>
        <ul class="list-group">
            {% for redactor in redactores %}
                {% if estados_aprobacion[redactor.user_id] %}
                    <li class="list-group-item"><i class="fa fa-square" style="font-size:24px;color:green"></i> {{ redactor.iniciales }} {{ redactor.nombre }} </li>
                {% else %}
                    <li class="list-group-item"><i class="fa fa-square-o" style="font-size:24px;color:green"></i> {{ redactor.iniciales }} {{ redactor.nombre }} </li>
                {% endif %}
            {% endfor %}
        </ul>
        <h4>Aprobadores:</h4>
        <ul class="list-group">
            {% for aprobador in aprobadores %}
                {% if estados_aprobacion[aprobador.user_id] %}
                    <li class="list-group-item"><i class="fa fa-square" style="font-size:24px;color:green"></i> {{ aprobador.iniciales }} {{ aprobador.nombre }} </li>
                {% else %}
                    <li class="list-group-item"><i class="fa fa-square-o" style="font-size:24px;color:green"></i> {{ aprobador.iniciales }} {{ aprobador.nombre }} </li>
                {% endif %}
            {% endfor %}
        </ul>
        <h4>Comentadores:</h4>
        <ul class="list-group">
            {% for comentador in comentadores %}
                <li class="list-group-item">{{ comentador.iniciales }} {{ comentador.nombre }}</li>
            {% endfor %}
        </ul>
    </div>
    <div class="col-md-8">
        <div class="row">
            <div class="col-md-4">
                <h4>Redacciones</h4>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <tbody>
                            {% for version in redacciones %}
                                <tr>
                                    <td>{{ version.redactor.iniciales }}_{{ version.fecha.strftime('%m_%d') }}</td>
                                    <td>{{ version.nombre }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-4">
                <h4>Comentarios</h4>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <tbody>
                            {% for comentario in comentarios %}
                                <tr>
                                    <td>{{ comentario.redactor.iniciales }}_{{ comentario.fecha.strftime('%m_%d') }}</td>
                                    <td>{{ comentario.nombre }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            {% if ((user in aprobadores) or (user in redactores)) %}
                <div class="col-md-2">
                    <form id="fileForm" action="#" method="POST" enctype=multipart/form-data>
                        <label id="fileInputLabel" for="fileInput" class="btn btn-default btn-block">
                            Cargar
                        </label>
                        <div style='padding-top: 5px; display: none' class="slider">
                            <label id="fileSubmitLabel" for="fileSubmit" class="btn btn-default btn-block">Enviar</label>
                            <button onclick="removeFile()" class="btn btn-default btn-block">Eliminar</button>
                        </div>
                        <div style='display: none'>
                            <input id="fileInput" type="file" name ="file" onchange="fileLoaded(this)">
                        </div>
                        <div style='display: none'>
                            <input id="fileSubmit" type="submit">
                        </div>
                    </form>
                </div>
                <div class="col-md-2">
                    <p><a class="btn btn-default btn-block">Comentar</a></p>
                </div>
                <div class="col-md-2">
                    <p><button id="boton" onclick="cambiarAprobacion()" class="btn btn-default btn-block">Aprobar</button></p>
                </div>
                <div class="col-md-2">
                    <p><a class="btn btn-default btn-block" href="{{ url_for('notas') }}">Volver</a></p>
                </div>
            {% else %}
                <div class="col-md-3">
                    <p><a class="btn btn-default btn-block">Cargar</a></p>
                </div>
                <div class="col-md-3">
                    <p><a class="btn btn-default btn-block">Comentar</a></p>
                </div>
                <div class="col-md-3">
                    <p><a class="btn btn-default btn-block" href="{{ url_for('notas') }}">Volver</a></p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        console.log('ready');
    });

    function fileLoaded(obj){
        var file = obj.value;
        var fileName = file.split("\\");
        document.getElementById("fileInputLabel").innerHTML = fileName[fileName.length-1];
        $(".slider").slideDown()
        event.preventDefault();
    }

    function removeFile(){
        $(".slider").slideUp();
        document.getElementById("fileForm").reset();
        document.getElementById("fileInputLabel").innerHTML = "Cargar";
        event.preventDefault();
    }

    function cambiarAprobacion() {       
        if (document.getElementById("boton").innerHTML == "Aprobar") {
            document.getElementById("boton").innerHTML = "Desaprobar";
        } 
        else {
            document.getElementById("boton").innerHTML = "Aprobar";
        }
    }
</script>

{% endblock %}
